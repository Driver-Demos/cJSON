# Purpose
The provided Ruby script, `unity_test_summary.rb`, is a utility designed to summarize test results for the Unity Test Framework, which is a test framework for C. This script processes test result files, typically generated by Unity, to produce a comprehensive summary of the test outcomes. It reads through specified directories to locate test result files, parses these files to extract details about passed, failed, and ignored tests, and then compiles this information into a human-readable report. The script is equipped to handle multiple result files, aggregating the data to provide an overall summary of the testing process, including the total number of tests, failures, and ignored tests.

The script defines a class `UnityTestSummary` that encapsulates the functionality for processing and summarizing test results. Key components of this class include methods for reading and parsing test result files, generating detailed reports of failures and ignored tests, and providing an overall test summary. The script also includes command-line interface functionality, allowing users to specify directories for result files and a root path for verbose output. The script is designed to be executed directly from the command line, where it handles input arguments, manages file paths, and outputs the test summary to the console. This utility is particularly useful for developers using the Unity Test Framework to quickly assess the status of their test suites and identify areas that require attention.
# Imports and Dependencies

---
- `fileutils`
- `set`


# Classes

---
### UnityTestSummary
- **Description**: The `UnityTestSummary` class is designed to process and summarize test results from Unity, a test framework for C. It reads test result files, parses them to extract the number of tests, failures, and ignored tests, and generates a comprehensive report summarizing these results. The class includes methods to handle file operations, parse test summaries, and format the output report. It also provides a usage method to guide users on how to run the script with the correct parameters. The class is intended to be run as a standalone script, which processes test result files from a specified directory and outputs a detailed summary of the test outcomes.
- **Includes**:
    - FileUtils::Verbose

**Attributes**

---
#### UnityTestSummary\.failures
- **Type**: `Integer`
- **Description**: The `failures` attribute is an integer that keeps track of the total number of test failures encountered during the execution of test files. It is initialized to zero and incremented as test results are processed.
- **Use**: This attribute is used to accumulate the count of failed tests across multiple test result files, contributing to the overall test summary report.


---
#### UnityTestSummary\.ignored
- **Type**: `Integer`
- **Description**: The `ignored` attribute is an integer that keeps track of the number of tests that were ignored during the test run. It is initialized to zero and is incremented each time an ignored test is encountered in the test results.
- **Use**: This attribute is used to accumulate the count of ignored tests and is included in the final test summary report.


---
#### UnityTestSummary\.report
- **Type**: `String`
- **Description**: The `report` attribute is a string that accumulates the summary of test results, including details about ignored and failed tests, as well as an overall summary of the total tests, failures, and ignored tests. It is initialized as an empty string and is populated during the execution of the `run` method.
- **Use**: This attribute is used to store and output the formatted summary of test results after processing the test files.


---
#### UnityTestSummary\.root=
- **Type**: `String`
- **Description**: The `root` attribute is a writable attribute that stores a string representing the root path used in the UnityTestSummary class. It is used to prepend to file paths when processing test result files, allowing for more verbose output if relative paths are used.
- **Use**: This attribute is used to set the root path for file operations, ensuring that file paths are correctly resolved during test result processing.


---
#### UnityTestSummary\.targets=
- **Type**: `Array<String>`
- **Description**: The `targets` attribute is an array of strings, where each string represents a file path to a test result file. These file paths are used to locate and process test results for generating a summary report.
- **Use**: This attribute is used to store and iterate over the list of test result file paths that need to be processed to generate the test summary report.


---
#### UnityTestSummary\.total\_tests
- **Type**: `Integer`
- **Description**: The `total_tests` attribute is an integer that keeps track of the total number of tests processed by the `UnityTestSummary` class. It is initialized to zero and incremented by the number of tests found in each result file processed during the execution of the `run` method.
- **Use**: This attribute is used to accumulate the total count of tests across multiple test result files, providing a summary of all tests processed.


**Instance Methods**

---
#### UnityTestSummary\.get\_details
The `get_details` method processes lines from a test result file to categorize them into failures, ignores, and successes based on their status.
- **Inputs**:
    - `_result_file`: A placeholder argument representing the result file being processed, not used in the method.
    - `lines`: An array of strings, each representing a line from the test result file, containing test details separated by colons.
- **Control Flow**:
    - Initialize a hash `results` with keys `:failures`, `:ignores`, and `:successes`, each pointing to an empty array.
    - Iterate over each `line` in the `lines` array.
    - Split each `line` into components using a colon as the delimiter, extracting `_src_file`, `_src_line`, `_test_name`, `status`, and `_msg`.
    - Construct `line_out` by prepending `@root` to `line` if `@root` is set and not zero, and replace forward slashes with backslashes.
    - Use a case statement to append `line_out` to the appropriate array in `results` based on the `status` value ('IGNORE', 'FAIL', or 'PASS').
- **Output**: A hash with keys `:failures`, `:ignores`, and `:successes`, each containing an array of processed lines categorized by their test status.


---
#### UnityTestSummary\.here
The `here` method returns the absolute path of the directory where the current file is located.
- **Inputs**: None
- **Control Flow**:
    - The method calls `File.dirname(__FILE__)` to get the directory name of the current file.
    - It then calls `File.expand_path` with the directory name to convert it to an absolute path.
    - The method returns the absolute path.
- **Output**: The method outputs a string representing the absolute path of the directory containing the current file.


---
#### UnityTestSummary\.initialize
The `initialize` method sets up initial values for the UnityTestSummary instance variables.
- **Inputs**:
    - `_opts`: An optional hash of options, which is not used in the method.
- **Control Flow**:
    - The method initializes the instance variable `@report` to an empty string.
    - The method initializes the instance variable `@total_tests` to 0.
    - The method initializes the instance variable `@failures` to 0.
    - The method initializes the instance variable `@ignored` to 0.
- **Output**: The method does not return any value; it initializes instance variables.


---
#### UnityTestSummary\.parse\_test\_summary
The `parse_test_summary` method extracts the number of tests, failures, and ignored tests from a summary string.
- **Inputs**:
    - `summary`: An array of strings representing the test summary, where each string may contain information about the number of tests, failures, and ignored tests.
- **Control Flow**:
    - The method checks if any string in the `summary` array matches the regular expression pattern for test results, which includes capturing groups for the number of tests, failures, and ignored tests.
    - If no match is found, the method raises an exception with a message indicating that the test results could not be parsed.
    - If a match is found, the method uses `Regexp.last_match` to retrieve the captured numbers from the last successful match and converts them to integers.
- **Output**: An array of three integers representing the number of tests, failures, and ignored tests, respectively.


---
#### UnityTestSummary\.run
The `run` method processes test result files to generate a summary report of total tests, failures, and ignored tests.
- **Inputs**: None
- **Control Flow**:
    - The method starts by normalizing the file paths in `@targets` to use forward slashes.
    - It initializes two arrays, `failure_output` and `ignore_output`, to store details of failed and ignored tests respectively.
    - The method iterates over each result file, reading its lines and checking if the file is empty, raising an error if so.
    - For each file, it calls `get_details` to extract failures and ignores, appending them to the respective arrays if they are not empty.
    - It then calls `parse_test_summary` to extract the number of tests, failures, and ignored tests, updating the instance variables `@total_tests`, `@failures`, and `@ignored`.
    - If there are any ignored tests, it appends a summary of ignored tests to `@report`.
    - If there are any failures, it appends a summary of failed tests to `@report`.
    - Finally, it appends an overall test summary to `@report`.
- **Output**: The method outputs a string stored in `@report`, which contains a detailed summary of the test results, including the number of total tests, failures, and ignored tests.


---
#### UnityTestSummary\.usage
The `usage` method displays an error message and usage instructions for the script, then exits the program.
- **Inputs**:
    - `err_msg`: An optional error message to be displayed before the usage instructions.
- **Control Flow**:
    - Prints a newline followed by 'ERROR: '.
    - If `err_msg` is provided, it prints the error message.
    - Prints usage instructions for the script, detailing the expected arguments and their descriptions.
    - Exits the program with a status code of 1.
- **Output**: The method does not return any value; it outputs text to the console and exits the program.



